<body>
  <h1>Voting App</h1>

  <!-- üîê LOGIN FORM -->
  <div id="loginSection">
    <h2>Login</h2>
    <form id="loginForm">
      <input type="text" id="loginId" placeholder="ID Number" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
  </div>

  <!-- üßæ REGISTRATION FORM (Admin Only for now) -->
  <div id="registerSection" class="hidden">
    <h2>Register New Voter</h2>
    <form id="registerForm">
      <input type="text" id="regId" placeholder="ID Number" required />
      <input type="text" id="regName" placeholder="Full Name" required />
      <input type="password" id="regPassword" placeholder="Password" required />
      <button type="submit">Register</button>
    </form>
  </div>

  <!-- ‚úÖ LOGGED-IN VOTER/ADMIN SECTION -->
  <div id="mainApp" class="hidden">
    <h2>Welcome, <span id="userName"></span>!</h2>
    <p id="userType"></p>
    <div id="pollList"></div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    let currentUser = null;

    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      const id = document.getElementById('loginId').value;
      const password = document.getElementById('loginPassword').value;

      const res = await fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, password })
      });

      const data = await res.json();
      if (res.ok) {
        currentUser = { id, name: data.name, isAdmin: data.isAdmin };
        showApp();
      } else {
        alert(data.error || 'Login failed');
      }
    };

    document.getElementById('registerForm').onsubmit = async (e) => {
      e.preventDefault();
      const id = document.getElementById('regId').value;
      const name = document.getElementById('regName').value;
      const password = document.getElementById('regPassword').value;

      const res = await fetch('/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, name, password })
      });

      const data = await res.json();
      if (res.ok) {
        alert('User registered');
        document.getElementById('registerForm').reset();
      } else {
        alert(data.error || 'Failed to register');
      }
    };

    function showApp() {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userType').textContent = currentUser.isAdmin ? "üëë Admin" : "üßë‚Äçüíº Voter";

      if (currentUser.isAdmin) {
        document.getElementById('registerSection').classList.remove('hidden');
        // show admin-only links or actions
      } else {
        document.getElementById('registerSection').classList.add('hidden');
        // show voting area
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('registerSection').classList.add('hidden');
      document.getElementById('loginSection').classList.remove('hidden');
    }
  </script>
</body>
