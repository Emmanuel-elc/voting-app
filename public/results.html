<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Poll Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="results-container">
    <h2>Poll Results</h2>
    <canvas id="resultsChart"></canvas>
    <a href="/" class="back-button">‚Üê Back to Voting</a>
  </div>

  <script>
    // Get poll ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const pollId = urlParams.get('id');

    if (!pollId) {
      alert("No poll ID provided.");
      window.location.href = '/';
    }

    // Fetch poll data and render chart
    async function loadResults() {
      try {
        const res = await fetch(`/polls/${pollId}`);
        if (!res.ok) throw new Error('Failed to load poll');
        const poll = await res.json();

        drawChart(poll);
      } catch (err) {
        alert("Error loading poll results.");
        console.error(err);
      }
    }

    // Render chart
    function drawChart(poll) {
      const ctx = document.getElementById('resultsChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(poll.options),
          datasets: [{
            label: 'Votes',
            data: Object.values(poll.options),
            backgroundColor: [
              '#4e79a7',
              '#f28e2b',
              '#e15759',
              '#76b7b2',
              '#59a14f',
              '#edc948',
              '#b07aa1',
              '#ff9da7',
              '#9c755f',
              '#bab0ac'
            ],
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: context => `${context.label}: ${context.parsed.y} vote(s)`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
    }

    loadResults();
  </script>
</body>
</html>
